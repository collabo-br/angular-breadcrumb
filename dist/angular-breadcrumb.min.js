/*! angular-breadcrumb - v0.5.0-dev-2017-03-30
* http://ncuillery.github.io/angular-breadcrumb
* Copyright (c) 2017 Nicolas Cuillery; Licensed MIT */
!function(a,b,c){"use strict";function d(a,c){return b.equals(a.length,c.length)?a>c:a.length>c.length}function e(a){var b=a.replace(/\n/g," ").match(/^([^(]+?)\s*(\((.*)\))?$/);if(!b||4!==b.length)throw new Error("Invalid state ref '"+a+"'");return{state:b[1],paramExpr:b[3]||null}}function f(a,b,d,e){var f=l[a];f!==c&&f(),f=b.$on(d,e),l[a]=f}function g(){var a={prefixStateName:null,template:"bootstrap3",templateUrl:null,templateLast:"default",templateLastUrl:null,includeAbstract:!1};this.setOptions=function(c){b.extend(a,c)},this.$get=["$injector",function(g){var h=g.get("$q"),i=g.get("$state"),j=g.get("$stateParams"),k=g.get("$rootScope"),l=k;f("$Breadcrumb.$viewContentLoaded",k,"$viewContentLoaded",function(a){!a.targetScope.ncyBreadcrumbIgnore&&d(a.targetScope.$id,l.$id)&&(l=a.targetScope)});var m=function(a){var b=a.parent||(/^(.+)\.[^.]+$/.exec(a.name)||[])[1],c="object"==typeof b;return c?b.name:b},n=function(a){return a=a?i.get(a):i.$current.self,a.ncyBreadcrumb&&b.isFunction(a.ncyBreadcrumb.dynamicStatesChain)},o=function(a){return b.isArray(a)&&(a=a[a.length-1]),"function"==typeof a||a.hasOwnProperty("$inject")},p=function(c,d){o(d)&&(d=g.invoke(d));for(var f,h,k=e(d.state||d),m=!1,p=!1,q=n(k.state),r=0,s=c.length;s>r&&!q;r+=1)if(c[r].name===k.state)return;f=i.get(k.state),q&&(f=b.extend({},f),f.ncyBreadcrumbLabel=d.label),f.ncyBreadcrumb&&(f.ncyBreadcrumb.force&&(m=!0),f.ncyBreadcrumb.skip&&(p=!0)),f["abstract"]&&!a.includeAbstract&&!m||p||(k.paramExpr&&(h=l.$eval(k.paramExpr)),f.ncyBreadcrumbLink=i.href(k.state,h||j||{}),f.ncyBreadcrumbStateRef=d.state||d,c.unshift(f))},q=function(a){var b=e(a),c=i.get(b.state);if(c.ncyBreadcrumb&&c.ncyBreadcrumb.parent){var d="function"==typeof c.ncyBreadcrumb.parent,f=d?c.ncyBreadcrumb.parent(l):c.ncyBreadcrumb.parent;if(f)return f}return m(c)};return{getTemplate:function(b){return a.templateUrl?null:b[a.template]?b[a.template]:a.template},getTemplateUrl:function(){return a.templateUrl},getTemplateLast:function(b){return a.templateLastUrl?null:b[a.templateLast]?b[a.templateLast]:a.templateLast},getTemplateLastUrl:function(){return a.templateLastUrl},getStatesChain:function(b){for(var c=[],d=i.$current.self.name;d;d=q(d))if(p(c,d),b&&c.length)return c;return a.prefixStateName&&p(c,a.prefixStateName),c},getDynamicStatesChain:function(){var c=[],d=i.$current.self,e=d.ncyBreadcrumb?d.ncyBreadcrumb.dynamicStatesChain:null;return b.isFunction(e)?h.when(e(g)).then(function(b){var d,e=0,f=b.length;for(e;f>e;e++)d=b[e],p(c,d);return a.prefixStateName&&p(c,a.prefixStateName),c}):this.getStatesChain()},getLastStep:function(){var a=this.getStatesChain(!0);return a.length?a[0]:c},$getLastViewScope:function(){return l},isDynamicChain:n}}]}function h(a){var c=a.get("$rootScope"),d=a.get("$breadcrumb"),e=a.get("$interpolate"),g=a.get("ncyBreadcrumbConfig"),h=g.templates;return{restrict:"AE",replace:!0,scope:{},template:d.getTemplate(h),templateUrl:d.getTemplateUrl(),link:{post:function(a){var g=[],h=function(){o(g),g=[];var c=d.$getLastViewScope();a.steps=d.getStatesChain(),b.forEach(a.steps,function(a){if(a.ncyBreadcrumb&&a.ncyBreadcrumb.label){var b=e(a.ncyBreadcrumb.label);a.ncyBreadcrumbLabel=b(c),n(g,b,c,a)}else a.ncyBreadcrumbLabel=a.name})};f("BreadcrumbDirective.$viewContentLoaded",c,"$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||h()}),h()}}}}function i(a,b,c){var d={"default":"{{ncyBreadcrumbLabel}}"};return{restrict:"A",scope:{},template:b.getTemplateLast(d),templateUrl:b.getTemplateLastUrl(),compile:function(d,e){var g=d.attr(e.$attr.ncyBreadcrumbLast);return g&&d.html(g),{post:function(d){var e=[],g=function(){o(e),e=[];var c=b.$getLastViewScope(),f=b.getLastStep();if(f)if(d.ncyBreadcrumbLink=f.ncyBreadcrumbLink,f.ncyBreadcrumb&&f.ncyBreadcrumb.label){var g=a(f.ncyBreadcrumb.label);d.ncyBreadcrumbLabel=g(c),n(e,g,c,d)}else d.ncyBreadcrumbLabel=f.name};f("BreadcrumbLastDirective.$viewContentLoaded",c,"$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||g()}),g()}}}}}function j(a,c,d){return{restrict:"A",scope:{},template:"{{ncyBreadcrumbChain}}",compile:function(e,g){var h=e.attr(g.$attr.ncyBreadcrumbText);h&&e.html(h);var i=e.attr(g.$attr.ncyBreadcrumbTextSeparator)||" / ";return{post:function(e){var g=[],h=function(a,c,d){b.forEach(m(c),function(b){var c=d.$watch(b,function(a,b){a!==b&&j()});a.push(c)})},j=function(){o(g),g=[];var d=c.$getLastViewScope(),f=c.getStatesChain(),j=[];b.forEach(f,function(b){if(b.ncyBreadcrumb&&b.ncyBreadcrumb.label){var c=a(b.ncyBreadcrumb.label);j.push(c(d)),h(g,c,d)}else j.push(b.name)}),e.ncyBreadcrumbChain=j.join(i)};f("BreadcrumbTextDirective.$viewContentLoaded",d,"$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||j()}),j()}}}}}function k(a){var c=a.get("$rootScope"),d=a.get("$breadcrumb"),e=a.get("$interpolate"),g=a.get("ncyBreadcrumbConfig"),h=g.templates;return{restrict:"AE",replace:!0,scope:{},template:d.getTemplate(h),templateUrl:d.getTemplateUrl(),link:{post:function(a){var g,h=[],i=function(){var c=d.$getLastViewScope();b.forEach(a.steps,function(a){if(a.ncyBreadcrumb&&a.ncyBreadcrumb.label){var b=e(a.ncyBreadcrumb.label);a.ncyBreadcrumbLabel=b(c),n(h,b,c,a)}else a.ncyBreadcrumbLabel=a.ncyBreadcrumbLabel||a.name})},j=function(){g=d.isDynamicChain(),g?d.getDynamicStatesChain().then(function(b){a.steps=b,i()}):(a.steps=d.getDynamicStatesChain(),i())};f("BreadcrumbDirective.$viewContentLoaded",c,"$viewContentLoaded",function(a){a.targetScope.ncyBreadcrumbIgnore||j()}),j()}}}}var l={},m=function(a){if(a.expressions)return a.expressions;var c=[];return b.forEach(a.parts,function(a){b.isFunction(a)&&c.push(a.exp)}),c},n=function(a,c,d,e){b.forEach(m(c),function(b){var f=d.$watch(b,function(){e.ncyBreadcrumbLabel=c(d)});a.push(f)})},o=function(a){b.forEach(a,function(a){a()})};h.$inject=["$injector"],i.$inject=["$interpolate","$breadcrumb","$rootScope"],j.$inject=["$interpolate","$breadcrumb","$rootScope"],k.$inject=["$injector"],b.module("ncy-angular-breadcrumb",["ui.router.state"]).provider("$breadcrumb",g).directive("ncyBreadcrumb",h).directive("ncyBreadcrumbLast",i).directive("ncyBreadcrumbText",j).directive("ncyBreadcrumbDynamicChain",k).constant("ncyBreadcrumbConfig",{templates:{bootstrap2:'<ul class="breadcrumb"><li ng-repeat="step in steps" ng-switch="$last || !!step.abstract" ng-class="{active: $last}"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span><span class="divider" ng-hide="$last">/</span></li></ul>',bootstrap3:'<ol class="breadcrumb"><li ng-repeat="step in steps" ng-class="{active: $last}" ng-switch="$last || !!step.abstract"><a ng-switch-when="false" href="{{step.ncyBreadcrumbLink}}">{{step.ncyBreadcrumbLabel}}</a><span ng-switch-when="true">{{step.ncyBreadcrumbLabel}}</span></li></ol>'}})}(window,window.angular);